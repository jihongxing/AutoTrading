# BTC 自动交易系统 — 前端可视化 PRD

> **版本**：v1.0  
> **日期**：2026-01-31  
> **状态**：待评审

---

## 一、概述

### 1.1 背景

后端系统已完成多用户 SaaS 架构，需要配套的前端可视化界面，让用户能够：
- 监控交易状态和持仓
- 查看风控指标和系统状态
- 管理账户和 API Key 配置
- 查看收益统计和历史记录

### 1.2 目标

- 提供响应式 Web 界面，支持桌面和移动端
- 实时展示交易数据和系统状态
- 用户友好的操作界面
- 管理员后台支持

### 1.3 核心原则

1. **移动优先** — 响应式设计，移动端体验优先
2. **实时性** — WebSocket 推送关键数据
3. **安全性** — JWT 认证，敏感操作二次确认
4. **简洁性** — 信息层级清晰，避免信息过载

---

## 二、技术栈

### 2.1 核心框架

| 技术 | 选型 | 理由 |
|------|------|------|
| 框架 | React 18 + TypeScript | 类型安全，生态成熟 |
| 构建 | Vite | 快速开发，HMR 支持 |
| 样式 | TailwindCSS | 响应式设计，移动端友好 |
| 状态 | Zustand | 轻量级，TypeScript 友好 |
| 请求 | TanStack Query | 缓存、重试、实时更新 |
| 图表 | Recharts + Lightweight Charts | 金融图表专业支持 |
| 路由 | React Router v6 | 标准路由方案 |
| UI 组件 | Radix UI + shadcn/ui | 无障碍，可定制 |

### 2.2 实时通信

```
WebSocket 连接：
├── /ws/trading    → 订单、持仓实时推送
├── /ws/risk       → 风控指标实时更新
├── /ws/state      → 状态机变更通知
└── /ws/market     → 行情数据推送
```

### 2.3 项目结构

```
frontend/
├── public/
├── src/
│   ├── api/              # API 请求封装
│   │   ├── client.ts     # Axios 实例
│   │   ├── auth.ts       # 认证接口
│   │   ├── trading.ts    # 交易接口
│   │   ├── risk.ts       # 风控接口
│   │   └── types.ts      # API 类型定义
│   ├── components/       # 通用组件
│   │   ├── ui/           # 基础 UI 组件
│   │   ├── charts/       # 图表组件
│   │   └── layout/       # 布局组件
│   ├── features/         # 功能模块
│   │   ├── dashboard/    # 仪表盘
│   │   ├── trading/      # 交易监控
│   │   ├── risk/         # 风控面板
│   │   ├── strategy/     # 策略管理
│   │   ├── learning/     # 自学习统计
│   │   ├── settings/     # 用户设置
│   │   └── admin/        # 管理后台
│   ├── hooks/            # 自定义 Hooks
│   ├── stores/           # Zustand 状态
│   ├── utils/            # 工具函数
│   ├── App.tsx
│   └── main.tsx
├── package.json
├── tailwind.config.js
├── tsconfig.json
└── vite.config.ts
```

---

## 三、页面设计

### 3.1 页面结构

```
┌─────────────────────────────────────────────────────────┐
│                      顶部导航栏                          │
│  Logo  |  Dashboard  Trading  Risk  Strategy  Settings  │
└─────────────────────────────────────────────────────────┘
                          │
    ┌─────────────────────┼─────────────────────┐
    │                     │                     │
    ▼                     ▼                     ▼
┌─────────┐         ┌─────────┐         ┌─────────┐
│ 用户页面 │         │ 管理页面 │         │ 公共页面 │
├─────────┤         ├─────────┤         ├─────────┤
│Dashboard│         │用户管理 │         │ 登录    │
│Trading  │         │平台统计 │         │ 注册    │
│Risk     │         │收益报表 │         │ 忘记密码│
│Strategy │         │系统配置 │         └─────────┘
│Learning │         └─────────┘
│Settings │
└─────────┘
```

### 3.2 页面优先级

| 优先级 | 页面 | 核心功能 | 移动端适配 |
|--------|------|----------|------------|
| P0 | 登录/注册 | 用户认证 | ✅ 必须 |
| P0 | Dashboard | 总览仪表盘 | ✅ 必须 |
| P0 | Trading | 持仓、订单监控 | ✅ 必须 |
| P1 | Risk | 风控指标、事件日志 | ✅ 必须 |
| P1 | Settings | API Key 配置 | ✅ 必须 |
| P2 | Strategy | 证人状态、权重 | ⚠️ 简化版 |
| P2 | Learning | 优化建议、统计 | ⚠️ 简化版 |
| P3 | Admin | 用户管理、平台统计 | ❌ 仅桌面 |

---

## 四、功能模块详细设计

### 4.1 Dashboard（仪表盘）

#### 4.1.1 桌面端布局

```
┌─────────────────────────────────────────────────────────┐
│                     Dashboard                            │
├─────────────┬─────────────┬─────────────┬───────────────┤
│  账户余额   │  今日 PnL   │  当前持仓   │  系统状态     │
│  $12,345    │  +$234.56   │  BTCUSDT    │  🟢 OBSERVING │
│  +2.3%      │  +1.9%      │  LONG 0.5   │               │
├─────────────┴─────────────┴─────────────┴───────────────┤
│                    收益曲线图（7天/30天/全部）            │
│  ┌─────────────────────────────────────────────────┐    │
│  │                    📈                            │    │
│  └─────────────────────────────────────────────────┘    │
├─────────────────────────────┬───────────────────────────┤
│       最近订单（5条）        │      风控指标             │
│  ┌───────────────────────┐  │  回撤: 3.2% / 20%        │
│  │ BUY  0.1 BTC @42000   │  │  日亏损: 0.5% / 3%       │
│  │ SELL 0.1 BTC @42500   │  │  连续亏损: 1 / 3         │
│  └───────────────────────┘  │  风控状态: 🟢 正常        │
└─────────────────────────────┴───────────────────────────┘
```

#### 4.1.2 移动端布局

```
┌─────────────────────┐
│     Dashboard       │
├─────────────────────┤
│  账户余额  $12,345  │
│  今日 PnL  +$234    │
├─────────────────────┤
│  系统状态           │
│  🟢 OBSERVING       │
├─────────────────────┤
│  当前持仓           │
│  BTCUSDT LONG 0.5   │
│  PnL: +$123 (+2.1%) │
├─────────────────────┤
│  收益曲线（简化）    │
│  ┌───────────────┐  │
│  │     📈        │  │
│  └───────────────┘  │
├─────────────────────┤
│  风控指标           │
│  回撤: 3.2%         │
│  日亏损: 0.5%       │
└─────────────────────┘
```

#### 4.1.3 数据接口

| 数据 | 接口 | 更新方式 |
|------|------|----------|
| 账户余额 | GET /users/me/positions | WebSocket |
| 今日 PnL | GET /users/me/profit | 轮询 30s |
| 系统状态 | GET /api/v1/state | WebSocket |
| 风控指标 | GET /users/me/risk | WebSocket |
| 收益曲线 | GET /users/me/profit?period=7d | 轮询 5min |

### 4.2 Trading（交易监控）

#### 4.2.1 功能模块

```
┌─────────────────────────────────────────────────────────┐
│                      Trading                             │
├─────────────────────────────────────────────────────────┤
│  K线图 + 交易标记                                        │
│  ┌─────────────────────────────────────────────────┐    │
│  │  📊 BTCUSDT 1H                                   │    │
│  │  ▲ 入场点  ▼ 出场点  ━ 止损线                    │    │
│  └─────────────────────────────────────────────────┘    │
├─────────────────────────────┬───────────────────────────┤
│       当前持仓               │      活跃订单             │
│  ┌───────────────────────┐  │  ┌─────────────────────┐  │
│  │ BTCUSDT               │  │  │ 限价单 @42000       │  │
│  │ LONG 0.5 BTC          │  │  │ 止损单 @41000       │  │
│  │ 入场: $42,000         │  │  │ 止盈单 @44000       │  │
│  │ 当前: $42,500         │  │  │                     │  │
│  │ PnL: +$250 (+1.19%)   │  │  │ [撤销] [修改]       │  │
│  │ 止损: $41,000         │  │  └─────────────────────┘  │
│  │ 止盈: $44,000         │  │                           │
│  └───────────────────────┘  │                           │
├─────────────────────────────┴───────────────────────────┤
│                    历史订单（分页）                       │
│  时间        | 方向 | 数量  | 价格   | 状态  | PnL       │
│  01-31 10:00 | BUY  | 0.5   | 42000  | FILLED| -         │
│  01-30 15:30 | SELL | 0.3   | 41500  | FILLED| +$150     │
└─────────────────────────────────────────────────────────┘
```

#### 4.2.2 K线图功能

- 支持时间周期：1m, 5m, 15m, 1h, 4h, 1d
- 交易标记：入场点（绿色▲）、出场点（红色▼）
- 止损止盈线：水平虚线显示
- 技术指标：MA、EMA、布林带（可选）

#### 4.2.3 移动端简化

- K线图全屏模式
- 持仓卡片式展示
- 订单列表下拉刷新
- 滑动撤销订单

### 4.3 Risk（风控面板）

#### 4.3.1 功能模块

```
┌─────────────────────────────────────────────────────────┐
│                        Risk                              │
├─────────────────────────────────────────────────────────┤
│  风控状态卡片                                            │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐    │
│  │ 🟢 正常  │  │回撤 3.2%│  │日亏0.5% │  │连亏 1次 │    │
│  │         │  │ /20%    │  │ /3%     │  │ /3次    │    │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘    │
├─────────────────────────────────────────────────────────┤
│  回撤曲线（30天）                                        │
│  ┌─────────────────────────────────────────────────┐    │
│  │  📉 最大回撤: 5.2% (01-15)                       │    │
│  │  ━━ 当前回撤  ┄┄ 警戒线  ── 锁定线               │    │
│  └─────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────┤
│  风控事件日志                                            │
│  ┌─────────────────────────────────────────────────┐    │
│  │ 🟡 01-31 09:00 日亏损接近阈值 (2.5%/3%)          │    │
│  │ 🟢 01-30 14:00 风控状态恢复正常                   │    │
│  │ 🔴 01-30 10:00 触发 COOLDOWN (连续亏损3次)       │    │
│  │ 🟡 01-29 16:00 回撤警告 (15%/20%)                │    │
│  └─────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────┘
```

#### 4.3.2 风控指标

| 指标 | 阈值 | 显示 |
|------|------|------|
| 当前回撤 | 20% | 进度条 + 百分比 |
| 日亏损 | 3% | 进度条 + 百分比 |
| 周亏损 | 10% | 进度条 + 百分比 |
| 连续亏损 | 3次 | 计数器 |
| 风控状态 | - | 状态徽章 |

#### 4.3.3 状态颜色

- 🟢 绿色：正常（< 50% 阈值）
- 🟡 黄色：警告（50-80% 阈值）
- 🔴 红色：危险（> 80% 阈值）
- ⚫ 灰色：锁定状态

### 4.4 Strategy（策略管理）

#### 4.4.1 功能模块

```
┌─────────────────────────────────────────────────────────┐
│                      Strategy                            │
├─────────────────────────────────────────────────────────┤
│  状态机可视化                                            │
│  ┌─────────────────────────────────────────────────┐    │
│  │  IDLE → OBSERVING → [READY] → EXECUTING → IDLE  │    │
│  │              ↓                                   │    │
│  │         RISK_LOCKED ← COOLDOWN                   │    │
│  │                                                  │    │
│  │  当前状态: 🟢 OBSERVING (持续 2h 15m)            │    │
│  └─────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────┤
│  证人状态                                                │
│  ┌─────────────────────────────────────────────────┐    │
│  │  核心证人 (TIER1)                                │    │
│  │  ├─ 波动率释放    🟢 活跃  胜率 62%  权重 0.35  │    │
│  │  └─ 区间破坏      🟢 活跃  胜率 58%  权重 0.30  │    │
│  │                                                  │    │
│  │  辅助证人 (TIER2)                                │    │
│  │  ├─ 时间结构      🟢 活跃  胜率 55%  权重 0.15  │    │
│  │  ├─ 流动性收割    🟡 静默  胜率 48%  权重 0.10  │    │
│  │  └─ 微结构异常    🟢 活跃  胜率 52%  权重 0.10  │    │
│  │                                                  │    │
│  │  否决证人 (TIER3)                                │    │
│  │  ├─ 风控哨兵      🟢 活跃  否决率 5%            │    │
│  │  └─ 宏观哨兵      🟢 活跃  否决率 3%            │    │
│  └─────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────┤
│  最近 Claim 记录                                         │
│  时间        | 证人       | 类型 | 方向 | 强度 | 状态    │
│  10:30:15   | 波动率释放  | LONG | BUY  | 0.72 | 通过    │
│  10:28:00   | 区间破坏    | LONG | BUY  | 0.65 | 通过    │
│  10:25:30   | 风控哨兵    | VETO | -    | -    | 否决    │
└─────────────────────────────────────────────────────────┘
```

#### 4.4.2 证人操作

- 查看证人详情
- 静默/激活证人（需确认）
- 查看证人历史表现
- 查看 Claim 详情

### 4.5 Settings（用户设置）

#### 4.5.1 功能模块

```
┌─────────────────────────────────────────────────────────┐
│                      Settings                            │
├─────────────────────────────────────────────────────────┤
│  账户信息                                                │
│  ┌─────────────────────────────────────────────────┐    │
│  │  邮箱: user@example.com                          │    │
│  │  订阅: PRO (到期: 2026-02-28)                    │    │
│  │  注册时间: 2026-01-01                            │    │
│  │  [修改密码]  [升级订阅]                          │    │
│  └─────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────┤
│  交易所配置                                              │
│  ┌─────────────────────────────────────────────────┐    │
│  │  Binance API                                     │    │
│  │  状态: 🟢 已验证 (最后验证: 2026-01-31 10:00)    │    │
│  │  API Key: ****...****ABCD                        │    │
│  │  测试网: ❌ 否                                    │    │
│  │  杠杆: 10x                                       │    │
│  │  最大仓位: 5%                                    │    │
│  │  [重新验证]  [修改配置]  [删除]                  │    │
│  └─────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────┤
│  通知设置                                                │
│  ┌─────────────────────────────────────────────────┐    │
│  │  ☑️ 交易执行通知                                  │    │
│  │  ☑️ 风控警告通知                                  │    │
│  │  ☑️ 系统状态变更通知                              │    │
│  │  ☐ 每日收益报告                                  │    │
│  └─────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────┘
```

#### 4.5.2 API Key 配置流程

```
1. 用户输入 API Key + Secret
2. 前端加密传输（HTTPS）
3. 后端验证 API 有效性
4. 检查权限（需要：读取 + 交易）
5. 验证通过 → 显示成功
6. 验证失败 → 显示错误原因
```

#### 4.5.3 安全提示

- API Key 仅显示后 4 位
- 修改配置需要密码确认
- 删除配置需要二次确认

### 4.6 Learning（自学习统计）

#### 4.6.1 功能模块

```
┌─────────────────────────────────────────────────────────┐
│                      Learning                            │
├─────────────────────────────────────────────────────────┤
│  学习报告概览                                            │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐    │
│  │总交易数 │  │ 胜率    │  │ 总PnL   │  │夏普比率 │    │
│  │  156    │  │ 58.3%   │  │ +$2,345 │  │  1.85   │    │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘    │
├─────────────────────────────────────────────────────────┤
│  优化建议（待审批）                                       │
│  ┌─────────────────────────────────────────────────┐    │
│  │ 🟡 权重调整: 波动率释放 0.35 → 0.38             │    │
│  │    原因: 近期胜率提升至 65%                      │    │
│  │    置信度: 78%                                   │    │
│  │    [批准] [拒绝] [详情]                          │    │
│  ├─────────────────────────────────────────────────┤    │
│  │ 🟡 止损调整: 默认止损 2% → 1.8%                 │    │
│  │    原因: 回测显示更优风险收益比                  │    │
│  │    置信度: 72%                                   │    │
│  │    [批准] [拒绝] [详情]                          │    │
│  └─────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────┤
│  证人表现排名                                            │
│  排名 | 证人       | 胜率  | 贡献PnL | 趋势              │
│  1    | 波动率释放  | 65%   | +$890   | 📈               │
│  2    | 区间破坏    | 58%   | +$650   | →                │
│  3    | 时间结构    | 55%   | +$420   | 📈               │
└─────────────────────────────────────────────────────────┘
```

### 4.7 Admin（管理后台）

#### 4.7.1 功能模块（仅桌面端）

```
┌─────────────────────────────────────────────────────────┐
│                       Admin                              │
├─────────────────────────────────────────────────────────┤
│  平台统计                                                │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐    │
│  │总用户数 │  │活跃用户 │  │总交易量 │  │平台收益 │    │
│  │   89    │  │   45    │  │ $1.2M   │  │ $12,345 │    │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘    │
├─────────────────────────────────────────────────────────┤
│  用户管理                                                │
│  搜索: [____________] [筛选: 全部 ▼]                    │
│  ┌─────────────────────────────────────────────────┐    │
│  │ ID     | 邮箱           | 状态  | 订阅 | 操作    │    │
│  │ u001   | a@example.com  | 🟢活跃 | PRO  | [详情]  │    │
│  │ u002   | b@example.com  | 🟡暂停 | BASIC| [详情]  │    │
│  │ u003   | c@example.com  | 🟢活跃 | FREE | [详情]  │    │
│  └─────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────┤
│  系统操作                                                │
│  [强制锁定系统]  [查看审计日志]  [系统配置]              │
└─────────────────────────────────────────────────────────┘
```

#### 4.7.2 管理员权限

| 操作 | 权限要求 | 二次确认 |
|------|----------|----------|
| 查看用户列表 | Admin | ❌ |
| 查看用户详情 | Admin | ❌ |
| 暂停用户 | Admin | ✅ |
| 封禁用户 | Admin | ✅ |
| 强制锁定系统 | Admin | ✅ |
| 审批优化建议 | Admin | ✅ |

---

## 五、API 对接

### 5.1 认证接口

| 方法 | 路径 | 说明 | 前端页面 |
|------|------|------|----------|
| POST | /auth/register | 用户注册 | 注册页 |
| POST | /auth/login | 用户登录 | 登录页 |
| POST | /auth/logout | 用户登出 | 全局 |
| POST | /auth/refresh | 刷新 Token | 自动 |

### 5.2 用户接口

| 方法 | 路径 | 说明 | 前端页面 |
|------|------|------|----------|
| GET | /users/me | 获取用户信息 | Settings |
| PUT | /users/me | 更新用户信息 | Settings |
| GET | /users/me/exchange | 获取交易所配置 | Settings |
| PUT | /users/me/exchange | 更新交易所配置 | Settings |
| POST | /users/me/exchange/verify | 验证 API Key | Settings |
| GET | /users/me/positions | 获取持仓 | Dashboard, Trading |
| GET | /users/me/orders | 获取订单 | Trading |
| GET | /users/me/profit | 获取收益 | Dashboard |
| GET | /users/me/risk | 获取风控状态 | Dashboard, Risk |

### 5.3 系统接口

| 方法 | 路径 | 说明 | 前端页面 |
|------|------|------|----------|
| GET | /api/v1/state | 获取系统状态 | Dashboard, Strategy |
| GET | /api/v1/state/history | 状态历史 | Strategy |
| GET | /api/v1/risk/status | 风控状态 | Risk |
| GET | /api/v1/risk/events | 风控事件 | Risk |
| GET | /api/v1/witnesses | 证人列表 | Strategy |
| GET | /api/v1/witnesses/{id} | 证人详情 | Strategy |
| GET | /api/v1/learning/report | 学习报告 | Learning |
| GET | /api/v1/learning/suggestions | 优化建议 | Learning |

### 5.4 管理接口

| 方法 | 路径 | 说明 | 前端页面 |
|------|------|------|----------|
| GET | /admin/users | 用户列表 | Admin |
| GET | /admin/users/{id} | 用户详情 | Admin |
| POST | /admin/users/{id}/suspend | 暂停用户 | Admin |
| GET | /admin/stats | 平台统计 | Admin |
| POST | /api/v1/state/force-lock | 强制锁定 | Admin |
| POST | /api/v1/learning/approve | 审批建议 | Admin, Learning |

---

## 六、WebSocket 设计

### 6.1 连接管理

```typescript
// WebSocket 连接配置
const WS_CONFIG = {
  trading: '/ws/trading',    // 订单、持仓
  risk: '/ws/risk',          // 风控指标
  state: '/ws/state',        // 状态机
  market: '/ws/market',      // 行情数据
};

// 重连策略
const RECONNECT = {
  maxRetries: 5,
  baseDelay: 1000,           // 1s
  maxDelay: 30000,           // 30s
  backoffMultiplier: 2,
};
```

### 6.2 消息格式

```typescript
// 服务端推送消息
interface WSMessage {
  type: 'position' | 'order' | 'risk' | 'state' | 'market';
  action: 'update' | 'create' | 'delete';
  data: any;
  timestamp: string;
}

// 示例：持仓更新
{
  "type": "position",
  "action": "update",
  "data": {
    "symbol": "BTCUSDT",
    "side": "LONG",
    "quantity": 0.5,
    "entry_price": 42000,
    "current_price": 42500,
    "unrealized_pnl": 250
  },
  "timestamp": "2026-01-31T10:30:00Z"
}
```

### 6.3 订阅管理

| 频道 | 订阅条件 | 数据频率 |
|------|----------|----------|
| trading | 登录后自动 | 实时 |
| risk | 登录后自动 | 5s |
| state | 登录后自动 | 事件触发 |
| market | 进入 Trading 页 | 1s |

---

## 七、移动端适配

### 7.1 响应式断点

```css
/* TailwindCSS 断点 */
sm: 640px   /* 手机横屏 */
md: 768px   /* 平板竖屏 */
lg: 1024px  /* 平板横屏 / 小桌面 */
xl: 1280px  /* 桌面 */
```

### 7.2 移动端优化

| 功能 | 桌面端 | 移动端 |
|------|--------|--------|
| 导航 | 顶部导航栏 | 底部 Tab 栏 |
| K线图 | 内嵌显示 | 全屏模式 |
| 表格 | 完整列 | 卡片式 |
| 操作 | 按钮 | 滑动手势 |
| 图表 | 完整交互 | 简化交互 |

### 7.3 底部导航栏（移动端）

```
┌─────────────────────────────────────┐
│  🏠      📊      ⚠️      ⚙️      │
│ Dashboard Trading  Risk  Settings  │
└─────────────────────────────────────┘
```

### 7.4 触摸优化

- 最小点击区域：44x44px
- 滑动刷新：下拉刷新数据
- 滑动操作：左滑撤销订单
- 长按操作：查看详情

---

## 八、安全设计

### 8.1 认证机制

```
JWT Token 流程：
1. 登录成功 → 返回 access_token + refresh_token
2. access_token 有效期：15 分钟
3. refresh_token 有效期：7 天
4. 自动刷新：access_token 过期前 1 分钟
5. 刷新失败 → 跳转登录页
```

### 8.2 敏感操作确认

| 操作 | 确认方式 |
|------|----------|
| 修改 API Key | 输入密码 |
| 删除 API Key | 二次确认弹窗 |
| 静默证人 | 二次确认弹窗 |
| 强制锁定系统 | 输入密码 + 原因 |
| 审批优化建议 | 二次确认弹窗 |

### 8.3 数据安全

- API Key 仅显示后 4 位
- 密码不在前端存储
- 敏感数据不写入 localStorage
- HTTPS 强制启用

---

## 九、部署架构

### 9.1 独立部署方案

```
┌─────────────────────────────────────────────────────────┐
│                      CDN (CloudFlare)                    │
│                           │                              │
│                           ▼                              │
│  ┌─────────────────────────────────────────────────┐    │
│  │              Nginx (静态资源)                    │    │
│  │              前端 SPA 应用                       │    │
│  └─────────────────────────────────────────────────┘    │
│                           │                              │
│                           ▼                              │
│  ┌─────────────────────────────────────────────────┐    │
│  │              API Gateway                         │    │
│  │              (CORS, Rate Limit)                  │    │
│  └─────────────────────────────────────────────────┘    │
│                           │                              │
│                           ▼                              │
│  ┌─────────────────────────────────────────────────┐    │
│  │              Backend API                         │    │
│  │              (FastAPI)                           │    │
│  └─────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────┘
```

### 9.2 环境配置

```typescript
// 环境变量
const ENV = {
  development: {
    API_URL: 'http://localhost:8000',
    WS_URL: 'ws://localhost:8000',
  },
  staging: {
    API_URL: 'https://api-staging.example.com',
    WS_URL: 'wss://api-staging.example.com',
  },
  production: {
    API_URL: 'https://api.example.com',
    WS_URL: 'wss://api.example.com',
  },
};
```

### 9.3 Docker 配置

```dockerfile
# frontend/Dockerfile
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

---

## 十、实现计划

### 10.1 阶段划分

| 阶段 | 内容 | 优先级 | 工作量 |
|------|------|--------|--------|
| P0 | 项目初始化 + 基础架构 | 高 | 1 天 |
| P0 | 登录/注册页面 | 高 | 1 天 |
| P0 | Dashboard 页面 | 高 | 2 天 |
| P0 | Trading 页面（基础） | 高 | 2 天 |
| P1 | Risk 页面 | 高 | 1 天 |
| P1 | Settings 页面 | 高 | 1 天 |
| P1 | WebSocket 集成 | 高 | 1 天 |
| P2 | Strategy 页面 | 中 | 2 天 |
| P2 | Learning 页面 | 中 | 1 天 |
| P2 | K线图集成 | 中 | 2 天 |
| P3 | Admin 页面 | 低 | 2 天 |
| P3 | 移动端优化 | 低 | 2 天 |

### 10.2 里程碑

| 里程碑 | 目标 | 预计时间 |
|--------|------|----------|
| M1 | 用户可登录、查看 Dashboard | 1 周 |
| M2 | 完整交易监控功能 | 2 周 |
| M3 | 风控 + 策略管理 | 3 周 |
| M4 | 管理后台 + 移动端优化 | 4 周 |

---

## 十一、验收标准

### 11.1 功能验收

- [ ] 用户可注册、登录、登出
- [ ] Dashboard 显示账户余额、持仓、PnL
- [ ] Trading 页面显示 K线图、订单、持仓
- [ ] Risk 页面显示风控指标和事件日志
- [ ] Settings 页面可配置 API Key
- [ ] WebSocket 实时推送数据
- [ ] 管理员可查看用户列表和平台统计

### 11.2 性能验收

- [ ] 首屏加载 < 3s
- [ ] API 响应 < 500ms
- [ ] WebSocket 延迟 < 100ms
- [ ] 移动端流畅滚动（60fps）

### 11.3 兼容性验收

- [ ] Chrome 90+
- [ ] Firefox 90+
- [ ] Safari 14+
- [ ] iOS Safari 14+
- [ ] Android Chrome 90+

---

## 十二、风险与对策

| 风险 | 影响 | 对策 |
|------|------|------|
| WebSocket 断连 | 数据不实时 | 自动重连 + 断连提示 |
| API 响应慢 | 用户体验差 | 骨架屏 + 缓存 |
| K线图性能 | 移动端卡顿 | 数据采样 + 虚拟滚动 |
| Token 过期 | 操作中断 | 静默刷新 + 提示重登 |

---

## 十三、后端 WebSocket 接口需求

> 当前后端尚未实现 WebSocket，需要新增以下接口：

### 13.1 需要后端新增

```python
# 新增 WebSocket 路由
@app.websocket("/ws/trading")
async def ws_trading(websocket: WebSocket, user_id: str):
    """推送订单、持仓更新"""
    pass

@app.websocket("/ws/risk")
async def ws_risk(websocket: WebSocket, user_id: str):
    """推送风控指标更新"""
    pass

@app.websocket("/ws/state")
async def ws_state(websocket: WebSocket):
    """推送状态机变更"""
    pass

@app.websocket("/ws/market")
async def ws_market(websocket: WebSocket, symbol: str):
    """推送行情数据"""
    pass
```

### 13.2 消息推送时机

| 事件 | 推送频道 | 触发条件 |
|------|----------|----------|
| 订单创建/更新 | trading | 订单状态变更 |
| 持仓变更 | trading | 开仓/平仓/价格更新 |
| 风控指标更新 | risk | 每 5 秒 / 阈值触发 |
| 状态机变更 | state | 状态转换时 |
| K线更新 | market | 每秒 |
