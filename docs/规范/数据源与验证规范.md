---
inclusion: always
priority: high
---

# BTC è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿ â€” æ•°æ®æºä¸éªŒè¯è§„èŒƒ

> **æ–‡æ¡£çº§åˆ«**ï¼šæ•°æ®è§„èŒƒ  
> **é€‚ç”¨èŒƒå›´**ï¼šæ‰€æœ‰æ•°æ®é‡‡é›†ã€å­˜å‚¨ã€éªŒè¯ç›¸å…³ä»£ç   
> **æ ¸å¿ƒåŸåˆ™**ï¼šæ•°æ®æ˜¯ç³»ç»Ÿçš„åŸºç¡€ï¼Œå¿…é¡»å¯è¿½æº¯ã€å¯å¤ç°ã€å¯å®¡è®¡

---

## 1ï¸âƒ£ æ•°æ®æºåˆ†ç±»

### 1.1 æ•°æ®æºå±‚çº§

| å±‚çº§ | ç±»å‹ | æ•°æ®æº | ä¼˜å…ˆçº§ | å¯é æ€§ |
|------|------|--------|--------|--------|
| **L1** | äº¤æ˜“æ‰€å®˜æ–¹ | Binance API, OKX API | æœ€é«˜ | â­â­â­â­â­ |
| **L2** | ä¸“ä¸šæ•°æ®å¹³å° | Coinglass, Glassnode, Kaiko | é«˜ | â­â­â­â­ |
| **L3** | èšåˆæ•°æ® | CoinGecko, CryptoCompare | ä¸­ | â­â­â­ |
| **L4** | é“¾ä¸Šæ•°æ® | Blockchain.com, Etherscan | ä¸­ | â­â­â­ |
| **L5** | ç¤¾åŒº/å¼€æº | GitHub æ•°æ®é›† | ä½ | â­â­ |

### 1.2 æ ¸å¿ƒæ•°æ®æºæ¸…å•

#### è¡Œæƒ…æ•°æ®ï¼ˆå¿…éœ€ï¼‰

| æ•°æ®ç±»å‹ | ä¸»æ•°æ®æº | å¤‡ç”¨æ•°æ®æº | æ›´æ–°é¢‘ç‡ |
|----------|----------|------------|----------|
| K çº¿æ•°æ® | Binance API | OKX API | å®æ—¶ |
| Tick æ•°æ® | Binance WebSocket | OKX WebSocket | å®æ—¶ |
| è®¢å•ç°¿ | Binance API | OKX API | 100ms |
| æˆäº¤æ˜ç»† | Binance API | OKX API | å®æ—¶ |

#### è¡ç”Ÿå“æ•°æ®ï¼ˆå¿…éœ€ï¼‰

| æ•°æ®ç±»å‹ | ä¸»æ•°æ®æº | å¤‡ç”¨æ•°æ®æº | æ›´æ–°é¢‘ç‡ |
|----------|----------|------------|----------|
| èµ„é‡‘è´¹ç‡ | Binance API | Coinglass | 8 å°æ—¶ |
| æŒä»“é‡ | Binance API | Coinglass | 5 åˆ†é’Ÿ |
| æ¸…ç®—æ•°æ® | Coinglass | Bybit API | å®æ—¶ |
| å¤šç©ºæ¯” | Binance API | Coinglass | 5 åˆ†é’Ÿ |

#### é“¾ä¸Šæ•°æ®ï¼ˆå¯é€‰ï¼‰

| æ•°æ®ç±»å‹ | ä¸»æ•°æ®æº | æ›´æ–°é¢‘ç‡ |
|----------|----------|----------|
| äº¤æ˜“æ‰€å‡€æµå…¥ | Glassnode | 1 å°æ—¶ |
| å·¨é²¸è½¬è´¦ | Whale Alert | å®æ—¶ |
| æ´»è·ƒåœ°å€ | Glassnode | 1 å¤© |

---

## 2ï¸âƒ£ æ•°æ®å­˜å‚¨è§„èŒƒ

### 2.1 å­˜å‚¨æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ•°æ®é‡‡é›†å±‚ (Collector)          â”‚
â”‚  Binance API â†’ Kafka â†’ QuestDB          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           çƒ­æ•°æ®å±‚ (Hot Storage)          â”‚
â”‚  QuestDB: æœ€è¿‘ 7 å¤©æ•°æ®                   â”‚
â”‚  ç”¨é€”: å®æ—¶äº¤æ˜“ã€ç­–ç•¥è®¡ç®—                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ¸©æ•°æ®å±‚ (Warm Storage)         â”‚
â”‚  QuestDB: æœ€è¿‘ 90 å¤©æ•°æ®                  â”‚
â”‚  ç”¨é€”: å›æµ‹ã€éªŒè¯ã€è‡ªå­¦ä¹                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å†·æ•°æ®å±‚ (Cold Storage)         â”‚
â”‚  Parquet æ–‡ä»¶: å†å²å…¨é‡æ•°æ®               â”‚
â”‚  ç”¨é€”: é•¿æœŸå›æµ‹ã€ç ”ç©¶åˆ†æ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®ä¿ç•™ç­–ç•¥

| æ•°æ®ç±»å‹ | çƒ­å­˜å‚¨ | æ¸©å­˜å‚¨ | å†·å­˜å‚¨ | æ€»ä¿ç•™ |
|----------|--------|--------|--------|--------|
| Tick æ•°æ® | 7 å¤© | 30 å¤© | 3 å¹´ | 3 å¹´ |
| K çº¿æ•°æ® | 7 å¤© | 90 å¤© | æ°¸ä¹… | æ°¸ä¹… |
| è®¢å•ç°¿å¿«ç…§ | 1 å¤© | 7 å¤© | 1 å¹´ | 1 å¹´ |
| èµ„é‡‘è´¹ç‡ | 7 å¤© | 90 å¤© | æ°¸ä¹… | æ°¸ä¹… |
| æ¸…ç®—æ•°æ® | 7 å¤© | 90 å¤© | 3 å¹´ | 3 å¹´ |
| äº¤æ˜“è®°å½• | æ°¸ä¹… | - | - | æ°¸ä¹… |
| ç­–ç•¥ä¿¡å· | æ°¸ä¹… | - | - | æ°¸ä¹… |

### 2.3 å­˜å‚¨æ ¼å¼è§„èŒƒ

#### æ•°æ®åº“å­˜å‚¨ï¼ˆQuestDBï¼‰

```sql
-- K çº¿æ•°æ®è¡¨
CREATE TABLE market_bar (
    ts TIMESTAMP,
    symbol SYMBOL,
    interval SYMBOL,      -- 1m, 5m, 15m, 1h, 4h, 1d
    open DOUBLE,
    high DOUBLE,
    low DOUBLE,
    close DOUBLE,
    volume DOUBLE,
    quote_volume DOUBLE,
    trades INT
) TIMESTAMP(ts) PARTITION BY DAY;

-- èµ„é‡‘è´¹ç‡è¡¨
CREATE TABLE funding_rate (
    ts TIMESTAMP,
    symbol SYMBOL,
    funding_rate DOUBLE,
    mark_price DOUBLE,
    index_price DOUBLE
) TIMESTAMP(ts) PARTITION BY MONTH;

-- æ¸…ç®—æ•°æ®è¡¨
CREATE TABLE liquidation (
    ts TIMESTAMP,
    symbol SYMBOL,
    side SYMBOL,          -- LONG / SHORT
    quantity DOUBLE,
    price DOUBLE,
    usd_value DOUBLE
) TIMESTAMP(ts) PARTITION BY DAY;
```

#### æ–‡ä»¶å­˜å‚¨ï¼ˆParquetï¼‰

```python
# æ ‡å‡† Parquet Schema
PARQUET_SCHEMA = {
    "market_bar": {
        "ts": "timestamp[us]",
        "symbol": "string",
        "interval": "string",
        "open": "float64",
        "high": "float64",
        "low": "float64",
        "close": "float64",
        "volume": "float64",
        "quote_volume": "float64",
        "trades": "int32"
    },
    "funding_rate": {
        "ts": "timestamp[us]",
        "symbol": "string",
        "funding_rate": "float64",
        "mark_price": "float64",
        "index_price": "float64"
    }
}

# æ–‡ä»¶å‘½åè§„èŒƒ
# {data_type}_{symbol}_{start_date}_{end_date}.parquet
# ç¤ºä¾‹: market_bar_BTCUSDT_20240101_20241231.parquet
```

---

## 3ï¸âƒ£ æ•°æ®æ ¼å¼æ ‡å‡†ï¼ˆé€šç”¨æ€§ï¼‰

### 3.1 æ—¶é—´æ ¼å¼

```python
# ç»Ÿä¸€ä½¿ç”¨ UTC æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
TIMESTAMP_FORMAT = "milliseconds since epoch (UTC)"

# ç¤ºä¾‹
ts = 1706601600000  # 2024-01-30 08:00:00 UTC

# è½¬æ¢å‡½æ•°
def to_utc_ms(dt: datetime) -> int:
    return int(dt.replace(tzinfo=timezone.utc).timestamp() * 1000)

def from_utc_ms(ts: int) -> datetime:
    return datetime.fromtimestamp(ts / 1000, tz=timezone.utc)
```

### 3.2 ä»·æ ¼/æ•°é‡ç²¾åº¦

```python
# ä»·æ ¼ç²¾åº¦ï¼š8 ä½å°æ•°ï¼ˆä¸äº¤æ˜“æ‰€ä¸€è‡´ï¼‰
PRICE_PRECISION = 8

# æ•°é‡ç²¾åº¦ï¼š8 ä½å°æ•°
QUANTITY_PRECISION = 8

# ç¤ºä¾‹
price = 82500.12345678
quantity = 0.00123456
```

### 3.3 æ ‡å‡†æ•°æ®æ¨¡å‹ï¼ˆPydanticï¼‰

```python
from datetime import datetime
from pydantic import BaseModel, Field

class MarketBar(BaseModel):
    """K çº¿æ•°æ®æ ‡å‡†æ¨¡å‹"""
    ts: int = Field(description="UTC æ¯«ç§’æ—¶é—´æˆ³")
    symbol: str = Field(default="BTCUSDT")
    interval: str = Field(description="1m/5m/15m/1h/4h/1d")
    open: float
    high: float
    low: float
    close: float
    volume: float
    quote_volume: float
    trades: int

class FundingRate(BaseModel):
    """èµ„é‡‘è´¹ç‡æ ‡å‡†æ¨¡å‹"""
    ts: int
    symbol: str = "BTCUSDT"
    funding_rate: float
    mark_price: float
    index_price: float

class Liquidation(BaseModel):
    """æ¸…ç®—æ•°æ®æ ‡å‡†æ¨¡å‹"""
    ts: int
    symbol: str = "BTCUSDT"
    side: str  # LONG / SHORT
    quantity: float
    price: float
    usd_value: float
```

### 3.4 æ•°æ®å¯¼å‡ºæ ¼å¼

| æ ¼å¼ | ç”¨é€” | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| **Parquet** | é•¿æœŸå­˜å‚¨ã€å›æµ‹ | å‹ç¼©ç‡é«˜ã€åˆ—å¼æŸ¥è¯¢å¿« | éœ€è¦ä¸“ç”¨å·¥å…· |
| **CSV** | æ•°æ®äº¤æ¢ã€è°ƒè¯• | é€šç”¨ã€æ˜“è¯» | æ–‡ä»¶å¤§ã€ç±»å‹ä¸¢å¤± |
| **JSON** | API ä¼ è¾“ | é€šç”¨ã€è‡ªæè¿° | æ–‡ä»¶å¤§ |

```python
# å¯¼å‡ºå‡½æ•°
def export_to_parquet(df: pd.DataFrame, path: str):
    df.to_parquet(path, compression='snappy')

def export_to_csv(df: pd.DataFrame, path: str):
    df.to_csv(path, index=False)

# å¯¼å…¥å‡½æ•°
def import_from_parquet(path: str) -> pd.DataFrame:
    return pd.read_parquet(path)
```

---

## 4ï¸âƒ£ éªŒè¯æ•°æ®è§„èŒƒ

### 4.1 éªŒè¯æ•°æ®è¦æ±‚

| è¦æ±‚ | æœ€ä½æ ‡å‡† | æ¨èæ ‡å‡† | è¯´æ˜ |
|------|----------|----------|------|
| æ—¶é—´è·¨åº¦ | 6 ä¸ªæœˆ | 2-3 å¹´ | è¦†ç›–å¤šç§å¸‚åœºå‘¨æœŸ |
| æ•°æ®ç²’åº¦ | 1 åˆ†é’Ÿ | 1 åˆ†é’Ÿ | æœ€å°ç²’åº¦ |
| æ•°æ®å®Œæ•´æ€§ | > 99% | > 99.9% | ç¼ºå¤±ç‡ |
| å¸‚åœºå‘¨æœŸ | ç‰›+ç†Š | ç‰›+ç†Š+éœ‡è¡ | å…¨å‘¨æœŸéªŒè¯ |

### 4.2 éªŒè¯æ•°æ®é›†åˆ’åˆ†

```python
# æ•°æ®é›†åˆ’åˆ†è§„èŒƒ
DATASET_SPLIT = {
    "train": 0.6,      # 60% è®­ç»ƒ/å¼€å‘
    "validation": 0.2, # 20% éªŒè¯/è°ƒå‚
    "test": 0.2        # 20% æœ€ç»ˆæµ‹è¯•ï¼ˆåªç”¨ä¸€æ¬¡ï¼‰
}

# æ—¶é—´é¡ºåºåˆ’åˆ†ï¼ˆç¦æ­¢éšæœºåˆ’åˆ†ï¼‰
# 2023-01-01 ~ 2024-06-30: è®­ç»ƒé›†
# 2024-07-01 ~ 2024-12-31: éªŒè¯é›†
# 2025-01-01 ~ 2025-12-31: æµ‹è¯•é›†
```

### 4.3 éªŒè¯æ•°æ®æ¥æº

```python
# éªŒè¯æ•°æ®è·å–æµç¨‹
class ValidationDataSource:
    """éªŒè¯æ•°æ®æº"""
    
    # 1. ä¼˜å…ˆä½¿ç”¨æœ¬åœ°å­˜å‚¨
    LOCAL_PATH = "data/historical/"
    
    # 2. æœ¬åœ°ä¸å­˜åœ¨åˆ™ä»æ•°æ®åº“æŸ¥è¯¢
    DB_CONNECTION = "questdb://localhost:9000"
    
    # 3. æ•°æ®åº“ä¸å­˜åœ¨åˆ™ä» API ä¸‹è½½
    API_SOURCES = {
        "binance": "https://api.binance.com",
        "coinglass": "https://api.coinglass.com"
    }
    
    def get_data(self, start: datetime, end: datetime) -> pd.DataFrame:
        # 1. æ£€æŸ¥æœ¬åœ°
        if self._check_local(start, end):
            return self._load_local(start, end)
        
        # 2. æ£€æŸ¥æ•°æ®åº“
        if self._check_db(start, end):
            return self._load_db(start, end)
        
        # 3. ä» API ä¸‹è½½å¹¶ä¿å­˜
        data = self._download_api(start, end)
        self._save_local(data)
        return data
```

---

## 5ï¸âƒ£ æ•°æ®è´¨é‡æ£€æŸ¥

### 5.1 æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

```python
def check_data_completeness(df: pd.DataFrame, interval: str) -> dict:
    """æ£€æŸ¥æ•°æ®å®Œæ•´æ€§"""
    
    # é¢„æœŸæ•°æ®ç‚¹æ•°
    expected_points = calculate_expected_points(
        df['ts'].min(), df['ts'].max(), interval
    )
    
    # å®é™…æ•°æ®ç‚¹æ•°
    actual_points = len(df)
    
    # ç¼ºå¤±ç‡
    missing_rate = 1 - (actual_points / expected_points)
    
    return {
        "expected": expected_points,
        "actual": actual_points,
        "missing_rate": missing_rate,
        "is_valid": missing_rate < 0.01  # ç¼ºå¤±ç‡ < 1%
    }
```

### 5.2 æ•°æ®å¼‚å¸¸æ£€æŸ¥

```python
def check_data_anomalies(df: pd.DataFrame) -> dict:
    """æ£€æŸ¥æ•°æ®å¼‚å¸¸"""
    
    anomalies = {
        # ä»·æ ¼å¼‚å¸¸
        "zero_price": (df['close'] == 0).sum(),
        "negative_price": (df['close'] < 0).sum(),
        
        # æˆäº¤é‡å¼‚å¸¸
        "zero_volume": (df['volume'] == 0).sum(),
        "negative_volume": (df['volume'] < 0).sum(),
        
        # æ—¶é—´å¼‚å¸¸
        "duplicate_ts": df['ts'].duplicated().sum(),
        "out_of_order": (df['ts'].diff() < 0).sum(),
        
        # OHLC å¼‚å¸¸
        "high_lt_low": (df['high'] < df['low']).sum(),
        "close_out_range": ((df['close'] > df['high']) | 
                           (df['close'] < df['low'])).sum()
    }
    
    return anomalies
```

### 5.3 æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

```python
def check_data_consistency(df: pd.DataFrame, source: str) -> dict:
    """è·¨æ•°æ®æºä¸€è‡´æ€§æ£€æŸ¥"""
    
    # ä»å¤‡ç”¨æ•°æ®æºè·å–åŒæœŸæ•°æ®
    backup_df = get_backup_data(df['ts'].min(), df['ts'].max())
    
    # ä»·æ ¼åå·®
    price_diff = (df['close'] - backup_df['close']).abs()
    price_deviation = price_diff.mean() / df['close'].mean()
    
    return {
        "price_deviation": price_deviation,
        "is_consistent": price_deviation < 0.001  # åå·® < 0.1%
    }
```

---

## 6ï¸âƒ£ æ•°æ® API è§„èŒƒ

### 6.1 å†…éƒ¨æ•°æ® API

```python
# æ•°æ®å±‚ API æ¥å£
class DataAPI:
    """ç»Ÿä¸€æ•°æ®è®¿é—®æ¥å£"""
    
    async def get_bars(
        self,
        symbol: str,
        interval: str,
        start: datetime,
        end: datetime
    ) -> list[MarketBar]:
        """è·å– K çº¿æ•°æ®"""
        pass
    
    async def get_funding_rates(
        self,
        symbol: str,
        start: datetime,
        end: datetime
    ) -> list[FundingRate]:
        """è·å–èµ„é‡‘è´¹ç‡"""
        pass
    
    async def get_liquidations(
        self,
        symbol: str,
        start: datetime,
        end: datetime
    ) -> list[Liquidation]:
        """è·å–æ¸…ç®—æ•°æ®"""
        pass
```

### 6.2 æ•°æ®è®¿é—®æƒé™

| æ¨¡å— | è¯»æƒé™ | å†™æƒé™ | è¯´æ˜ |
|------|--------|--------|------|
| ç­–ç•¥å±‚ | âœ… | âŒ | åªè¯» |
| é£æ§å±‚ | âœ… | âœ… äº‹ä»¶ | è¯» + å†™é£æ§äº‹ä»¶ |
| æ‰§è¡Œå±‚ | âœ… | âœ… è®¢å• | è¯» + å†™è®¢å•çŠ¶æ€ |
| è‡ªå­¦ä¹ å±‚ | âœ… å†å² | âŒ | åªè¯»å†å²æ•°æ® |
| æ•°æ®é‡‡é›† | âŒ | âœ… | åªå†™ |

---

## 7ï¸âƒ£ æ•°æ®å›æ”¾èƒ½åŠ›

### 7.1 å›æ”¾è¦æ±‚

```python
class DataReplay:
    """æ•°æ®å›æ”¾å¼•æ“"""
    
    def replay_market_data(
        self,
        start: datetime,
        end: datetime,
        speed: float = 1.0  # 1.0 = å®æ—¶é€Ÿåº¦
    ) -> AsyncIterator[MarketBar]:
        """å›æ”¾è¡Œæƒ…æ•°æ®"""
        pass
    
    def replay_signals(
        self,
        start: datetime,
        end: datetime
    ) -> AsyncIterator[StrategySignal]:
        """å›æ”¾ç­–ç•¥ä¿¡å·"""
        pass
    
    def replay_executions(
        self,
        start: datetime,
        end: datetime
    ) -> AsyncIterator[ExecutionOrder]:
        """å›æ”¾äº¤æ˜“æ‰§è¡Œ"""
        pass
```

### 7.2 å›æ”¾ç”¨é€”

| ç”¨é€” | è¯´æ˜ |
|------|------|
| ç­–ç•¥éªŒè¯ | ç”¨å†å²æ•°æ®éªŒè¯ç­–ç•¥æœ‰æ•ˆæ€§ |
| é—®é¢˜å¤ç° | å¤ç°å†å²äº¤æ˜“é—®é¢˜ |
| ç³»ç»Ÿå®¡è®¡ | å®¡è®¡å†å²äº¤æ˜“å†³ç­– |
| è‡ªå­¦ä¹ è®­ç»ƒ | ç”¨å†å²æ•°æ®è®­ç»ƒæ¨¡å‹ |

---

## 8ï¸âƒ£ æ•°æ®é‡‡é›†è§„èŒƒ

### 8.1 é‡‡é›†é¢‘ç‡

| æ•°æ®ç±»å‹ | é‡‡é›†é¢‘ç‡ | å»¶è¿Ÿè¦æ±‚ |
|----------|----------|----------|
| Tick æ•°æ® | å®æ—¶ | < 100ms |
| K çº¿æ•°æ® | æ¯åˆ†é’Ÿ | < 1s |
| è®¢å•ç°¿ | 100ms | < 200ms |
| èµ„é‡‘è´¹ç‡ | æ¯ 8 å°æ—¶ | < 1 åˆ†é’Ÿ |
| æ¸…ç®—æ•°æ® | å®æ—¶ | < 1s |

### 8.2 é‡‡é›†å®¹é”™

```python
class DataCollector:
    """æ•°æ®é‡‡é›†å™¨"""
    
    # é‡è¯•ç­–ç•¥
    MAX_RETRIES = 3
    RETRY_DELAY = 1.0  # ç§’
    
    # æ•°æ®æºåˆ‡æ¢
    async def collect_with_fallback(self, data_type: str):
        """å¸¦å®¹é”™çš„æ•°æ®é‡‡é›†"""
        sources = self.get_sources(data_type)
        
        for source in sources:
            try:
                return await self._collect(source, data_type)
            except Exception as e:
                logger.warning(f"æ•°æ®æº {source} å¤±è´¥: {e}")
                continue
        
        raise DataCollectionError("æ‰€æœ‰æ•°æ®æºéƒ½å¤±è´¥")
```

---

## ğŸ“‹ æ€»ç»“

### æ•°æ®æºä¼˜å…ˆçº§
1. äº¤æ˜“æ‰€å®˜æ–¹ APIï¼ˆæœ€å¯é ï¼‰
2. ä¸“ä¸šæ•°æ®å¹³å°ï¼ˆCoinglass, Glassnodeï¼‰
3. èšåˆæ•°æ®å¹³å°ï¼ˆå¤‡ç”¨ï¼‰

### å­˜å‚¨è§„èŒƒ
- çƒ­æ•°æ®ï¼šQuestDBï¼ˆ7 å¤©ï¼‰
- æ¸©æ•°æ®ï¼šQuestDBï¼ˆ90 å¤©ï¼‰
- å†·æ•°æ®ï¼šParquet æ–‡ä»¶ï¼ˆæ°¸ä¹…ï¼‰

### æ ¼å¼æ ‡å‡†
- æ—¶é—´ï¼šUTC æ¯«ç§’æ—¶é—´æˆ³
- ä»·æ ¼/æ•°é‡ï¼š8 ä½å°æ•°
- æ–‡ä»¶æ ¼å¼ï¼šParquetï¼ˆå­˜å‚¨ï¼‰ã€CSVï¼ˆäº¤æ¢ï¼‰

### éªŒè¯æ•°æ®è¦æ±‚
- æ—¶é—´è·¨åº¦ï¼šâ‰¥ 2 å¹´
- æ•°æ®å®Œæ•´æ€§ï¼š> 99%
- å¿…é¡»è¦†ç›–ï¼šç‰›å¸‚ + ç†Šå¸‚ + éœ‡è¡

### æ ¸å¿ƒåŸåˆ™
- æ•°æ®æ˜¯ç³»ç»Ÿçš„åŸºç¡€
- æ‰€æœ‰æ•°æ®å¿…é¡»å¯è¿½æº¯
- æ‰€æœ‰äº¤æ˜“å¿…é¡»å¯å›æ”¾
- æ•°æ®è´¨é‡ > æ•°æ®æ•°é‡
