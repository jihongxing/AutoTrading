# BTC 自动交易系统 — 编码前决策表格

> **文档级别**：决策记录 / 已冻结  
> **决策日期**：2026-01-30  
> **状态**：✅ 已批准

---

## 决策表格

| 序号 | 类别 | 决策点 | 可选方案 | 推荐方案 | 最终选型 | 负责人 | 备注 |
|------|------|--------|----------|----------|----------|--------|------|
| 1 | 技术栈 | 编程语言 | Python / Go / Rust | Python | **Python** | - | 生态丰富，数据处理+回测便利 |
| 2 | 技术栈 | Web框架 | FastAPI / Flask / 无 | FastAPI | **FastAPI** | - | 异步 + 自动文档 |
| 3 | 技术栈 | 异步框架 | asyncio / Trio | asyncio | **asyncio** | - | 标准库，生态成熟 |
| 4 | 技术栈 | 测试框架 | pytest / unittest | pytest | **pytest** | - | 插件丰富，社区活跃 |
| 5 | 技术栈 | 依赖管理 | Poetry / pip / venv | Poetry | **Poetry** | - | 统一管理依赖与虚拟环境 |
| 6 | 项目结构 | 目录结构 | src/, tests/, config/, scripts/ | 如上 | **如上** | - | 分层清晰，便于维护 |
| 7 | 项目结构 | 模块划分 | 按功能 / 按层级 | 按功能 + 层级 | **按功能 + 层级** | - | 核心内核 / 策略 / 风控 / 执行 / 数据 / 自学习 |
| 8 | 项目结构 | 配置管理 | YAML / TOML / 环境变量 | YAML + env | **YAML + env** | - | 可轻松修改参数，无需重启 |
| 9 | 接口规范 | API风格 | 内部函数 / REST / gRPC | 内部函数 + REST | **内部函数 + REST** | - | 内部模块函数调用，外部接口REST |
| 10 | 接口规范 | 数据格式 | JSON / Protobuf | JSON内部 / Protobuf跨系统 | **JSON内部 / Protobuf跨系统** | - | JSON简便，Protobuf可跨系统 |
| 11 | 接口规范 | 错误处理 | 异常 / 返回码 | 异常 + 返回码 | **异常 + 返回码** | - | 保证开发调试方便 |
| 12 | 接口规范 | 日志 | 文本 / 结构化 | 结构化 JSON | **结构化 JSON** | - | 方便监控与回溯 |
| 13 | 数据模型 | Python 数据类 | dataclass / Pydantic | Pydantic | **Pydantic v2** | - | 类型安全 + 数据验证 |
| 14 | 数据模型 | 枚举 | Enum / 常量 | Enum | **Enum** | - | 状态、证人类型、错误码 |
| 15 | 数据模型 | 时间处理 | UTC / 本地 | UTC | **UTC** | - | 内部统一，展示可转换本地时区 |
| 16 | 并发 | 并发模型 | 多线程 / 多进程 / 协程 | asyncio协程 | **asyncio协程** | - | I/O密集型优先 |
| 17 | 并发 | 锁机制 | asyncio.Lock / redis / 无 | asyncio.Lock + redis | **asyncio.Lock + redis** | - | 分布式锁保证订单顺序执行 |
| 18 | 并发 | 队列设计 | 内存 / Kafka | 内存队列(MVP) + Kafka(生产) | **内存队列(MVP) + Kafka(生产)** | - | 高并发时保证事件流顺序 |
| 19 | 错误处理 | 异常层级 | 自定义 / 系统异常 | 自定义异常类 | **自定义异常类** | - | OrderError / StrategyError / DataError |
| 20 | 错误处理 | 重试策略 | 固定间隔 / 指数退避 | 核心I/O指数退避 / 交易接口固定间隔 | **核心I/O指数退避 / 交易接口固定间隔** | - | 防止重复下单或丢单 |
| 21 | 错误处理 | 熔断机制 | 无 / RISK_LOCKED触发 | RISK_LOCKED触发 | **RISK_LOCKED触发** | - | 核心保证系统生存优先 |
| 22 | 测试 | 单元测试 | 无 / 70% / 90% | 覆盖≥90% | **覆盖≥90%** | - | 核心函数保证高覆盖 |
| 23 | 测试 | 集成测试 | 无 / 手动 / 自动 | 自动 | **自动** | - | 端到端验证策略 → 风控 → 执行 → 数据 |
| 24 | 测试 | Mock策略 | 无 / Mock交易所 | Mock交易所 + 历史行情 | **Mock交易所 + 历史行情** | - | 测试不依赖真实交易 |
| 25 | 部署 | 容器化 | 无 / Docker / VM | Docker + Compose | **Docker + Compose** | - | MVP快速迭代 |
| 26 | 部署 | 编排 | 无 / Compose / K8s | Compose(MVP) / K8s(生产) | **Compose(MVP) / K8s(生产)** | - | 生产可扩展到K8s |
| 27 | 部署 | 环境 | dev / staging / prod | 分开管理 | **分开管理** | - | 严格管理配置和密钥 |

---

## 使用方式

1. 每列"最终选型"由架构负责人或技术团队填定
2. "负责人"列标明落地责任人
3. 可直接作为**编码前决策审批表**，保证开发与设计一致
4. 后续如有变更，可更新在该表中，形成版本控制

---

## 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| v1.0 | 2026-01-30 | 初始版本，所有决策已确定 | - |

---

## 关联文档

- `.kiro/steering/架构约定与开发规范.md` - 架构约定（自动生效）
- `.kiro/steering/技术栈与编码规范.md` - 技术栈规范（自动生效）
- `docs/00-核心哲学/系统级架构冻结文档.md` - 架构冻结文档
- `docs/00-核心哲学/弱信号组合哲学与设计原则.md` - 核心哲学

---

**所有决策已冻结，开始编码！** 🚀
