# BTC 自动交易系统 — 交易规则 & 风控参数决策表

> **文档级别**：决策记录  
> **最后更新**：2026-01-30  
> **核心原则**：参数分层管理，明确可变性边界

---

## 📊 参数分类说明

| 层级 | 名称 | 可变性 | 修改方式 | 存储位置 |
|------|------|--------|----------|----------|
| **L0** | 宪法级 | 🔒 不可变 | 永不修改 | 硬编码 |
| **L1** | 系统配置 | ⚙️ 可配置 | 人工修改，重启生效 | `config/*.yaml` |
| **L2** | 风控阈值 | 🛡️ 受控可调 | 人工审批后修改 | `config/risk.yaml` |
| **L3** | 自学习参数 | 📊 动态调整 | 系统自动优化（有边界） | 数据库 |

---

## 📋 完整决策表格

| 序号 | 类别 | 规则项 | 默认值 | 层级 | 允许范围 | 说明 |
|------|------|--------|--------|------|----------|------|
| 1 | 架构 | 策略无下单权 | True | L0 | 不可变 | 宪法级约束 |
| 2 | 架构 | 风控硬否决权 | True | L0 | 不可变 | 宪法级约束 |
| 3 | 架构 | 状态机唯一入口 | True | L0 | 不可变 | 宪法级约束 |
| 4 | 架构 | TIER3 一票否决 | True | L0 | 不可变 | 宪法级约束 |
| 5 | 架构 | 最少同意证人 | 2 | L0 | 不可变 | 宪法级约束 |
| 6 | 交易所 | 主交易所 | Binance | L1 | Binance/OKX/Bybit | 系统配置 |
| 7 | 交易所 | 备用交易所 | OKX | L1 | OKX/Bybit | 系统配置 |
| 8 | 交易所 | API 限流 | 1200次/分 | L1 | 依交易所 | 系统配置 |
| 9 | 交易所 | 订单类型 | 市价+限价 | L1 | 市价/限价/条件单 | 系统配置 |
| 10 | 交易所 | 滑点容忍度 | 0.1% | L1 | 0.05%-0.2% | 系统配置 |
| 11 | 风控 | 最大回撤 | 20% | L2 | 15%-30% | 需审批 |
| 12 | 风控 | 单日最大亏损 | 3% | L2 | 2%-5% | 需审批 |
| 13 | 风控 | 连续亏损触发 | 3 次 | L2 | 2-5 次 | 需审批 |
| 14 | 风控 | 周最大亏损 | 10% | L2 | 5%-15% | 需审批 |
| 15 | 风控 | 波动率阈值 | ATR > 2x | L2 | 1.5x-3x | 需审批 |
| 16 | 风控 | 流动性阈值 | 价差 > 0.5% | L2 | 0.3%-1% | 需审批 |
| 17 | 风控 | 极端波动 | 1h > 10% | L2 | 5%-15% | 需审批 |
| 18 | 仓位 | 最大单笔仓位 | 5% | L2 | 3%-10% | 需审批 |
| 19 | 仓位 | 最大总仓位 | 30% | L2 | 20%-50% | 需审批 |
| 20 | 仓位 | 杠杆上限 | 5x | L2 | 3x-10x | 需审批 |
| 21 | 冷却 | 正常冷却 | 10 分钟 | L2 | 5-30 分钟 | 需审批 |
| 22 | 冷却 | 止损后冷却 | 20 分钟 | L2 | 10-60 分钟 | 需审批 |
| 23 | 冷却 | 连续亏损冷却 | 1 小时 | L2 | 30 分钟-4 小时 | 需审批 |
| 24 | 证人 | 核心:辅助权重 | 2:1 | L2 | 1:1 - 3:1 | 需审批 |
| 25 | 仓位 | 默认仓位比例 | 2% | L3 | 1%-3% | 自学习可调 |
| 26 | 仓位 | 仓位放大系数 | 1.0x | L3 | 0.5x-1.5x | 自学习可调 |
| 27 | 止损 | 默认止损 | 2% | L3 | 1.5%-2.5% | 自学习可调 |
| 28 | 止盈 | 默认止盈 | 3% | L3 | 2.5%-3.5% | 自学习可调 |
| 29 | 证人 | 证人权重 | 0.5 | L3 | 0.1-0.9 | 自学习可调 |
| 30 | 自学习 | 权重调整周期 | 每日 | L1 | 每日/每周 | 系统配置 |
| 31 | 自学习 | 权重调整幅度 | ±5% | L2 | ±3%-±10% | 需审批 |
| 32 | 自学习 | 最小样本量 | 50 笔 | L2 | 30-100 笔 | 需审批 |
| 33 | 自学习 | 降级阈值 | <30% | L2 | 20%-40% | 需审批 |
| 34 | 告警 | Telegram 通知 | 启用 | L1 | 启用/禁用 | 系统配置 |
| 35 | 告警 | 邮件通知 | 启用 | L1 | 启用/禁用 | 系统配置 |
| 36 | 回测 | 数据范围 | 3 年 | L1 | 1-5 年 | 系统配置 |
| 37 | 回测 | 手续费假设 | 0.1% | L1 | 0.05%-0.2% | 系统配置 |
| 38 | 回测 | 滑点假设 | 0.1% | L1 | 0.05%-0.2% | 系统配置 |

---

## 🔒 L0 宪法级参数（不可变）

```python
class ArchitectureConstants:
    STRATEGY_CAN_PLACE_ORDER = False      # 策略无下单权
    RISK_CONTROL_HAS_VETO = True          # 风控硬否决权
    STATE_MACHINE_IS_ONLY_ENTRY = True    # 状态机唯一入口
    TIER3_HAS_ABSOLUTE_VETO = True        # TIER3 一票否决
    MIN_WITNESSES_FOR_TRADE = 2           # 最少 2 个证人
```

---

## ⚙️ L1 系统配置（可配置）

```yaml
# config/system.yaml
exchange:
  primary: "binance"
  backup: "okx"
  api_rate_limit: 1200
  slippage_tolerance: 0.001

alerts:
  telegram: true
  email: true

backtest:
  data_years: 3
  commission_rate: 0.001
  slippage_rate: 0.001

learning:
  adjustment_cycle: "daily"
```

---

## 🛡️ L2 风控阈值（需审批）

```yaml
# config/risk.yaml
account_risk:
  max_drawdown: 0.20           # 范围: 0.15-0.30
  daily_max_loss: 0.03         # 范围: 0.02-0.05
  consecutive_loss_cooldown: 3 # 范围: 2-5
  weekly_max_loss: 0.10        # 范围: 0.05-0.15

market_risk:
  volatility_threshold: 2.0    # 范围: 1.5-3.0
  liquidity_threshold: 0.005   # 范围: 0.003-0.01
  extreme_volatility: 0.10     # 范围: 0.05-0.15

position:
  max_single: 0.05             # 范围: 0.03-0.10
  max_total: 0.30              # 范围: 0.20-0.50
  max_leverage: 5              # 范围: 3-10

cooldown:
  normal: 600                  # 范围: 300-1800 秒
  stop_loss: 1200              # 范围: 600-3600 秒
  consecutive_loss: 3600       # 范围: 1800-14400 秒

learning:
  max_weight_change: 0.05      # 范围: 0.03-0.10
  min_sample_count: 50         # 范围: 30-100
  demotion_threshold: 0.30     # 范围: 0.20-0.40
```

---

## 📊 L3 自学习参数（动态调整）

```python
# 存储在数据库，系统自动优化
LEARNING_BOUNDS = {
    # 证人权重
    "witness_weight": (0.1, 0.9),
    
    # 仓位相关
    "position_multiplier": (0.5, 1.5),
    "default_position_ratio": (0.01, 0.03),
    
    # 止盈止损微调
    "stop_loss_adjustment": (-0.005, 0.005),
    "take_profit_adjustment": (-0.005, 0.005),
}

# 自学习禁止触碰的参数
LEARNING_FORBIDDEN = [
    "max_drawdown",
    "daily_max_loss",
    "max_leverage",
    "max_single_position",
    "max_total_position",
]
```

---

## 📝 参数修改流程

### L1 系统配置
```
修改 config/system.yaml → PR 审查 → 合并 → 重启生效
```

### L2 风控阈值
```
提交申请 → 风控审批 → 修改 config/risk.yaml → 记录日志 → 重启生效
```

### L3 自学习参数
```
自学习计算 → 边界检查 → 写入数据库 → 实时生效 → 记录日志
```

---

**核心原则**：
- L0 保护架构完整性（永不改变）
- L1 提供运维灵活性（人工配置）
- L2 保障系统安全性（需要审批）
- L3 实现自动优化（有边界约束）
