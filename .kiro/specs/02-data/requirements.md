# Data 统一数据层 — 需求文档

## 模块定位
系统唯一、可信、可回放的数据事实源。所有模块只信任这一层。

## 功能需求

### FR-1: 数据采集
- FR-1.1: K 线数据采集（Binance API）
- FR-1.2: 资金费率采集
- FR-1.3: 清算数据采集
- FR-1.4: 订单簿快照采集
- FR-1.5: 数据源故障切换（主备）

### FR-2: 数据存储
- FR-2.1: QuestDB 时序数据存储
- FR-2.2: Kafka 消息流
- FR-2.3: 热/温/冷数据分层
- FR-2.4: Parquet 文件归档

### FR-3: 数据访问
- FR-3.1: 统一数据访问接口（DataAPI）
- FR-3.2: 策略层只读访问
- FR-3.3: 风控层读写事件
- FR-3.4: 执行层写订单状态

### FR-4: 数据回放
- FR-4.1: 指定时间段行情回放
- FR-4.2: 策略信号回放
- FR-4.3: 交易执行回放
- FR-4.4: 支持变速回放

### FR-5: 数据质量
- FR-5.1: 完整性检查（缺失率 < 1%）
- FR-5.2: 异常检查（价格/成交量）
- FR-5.3: 跨数据源一致性检查

## 非功能需求

### NFR-1: 延迟
- Tick 数据采集延迟 < 100ms
- K 线数据采集延迟 < 1s

### NFR-2: 可靠性
- 数据完整性 > 99%
- 支持故障自动切换

### NFR-3: 可审计
- 所有数据可追溯
- 所有交易可回放

## 约束条件
- QuestDB 作为时序数据库
- Kafka 作为消息队列
- 所有时间使用 UTC 毫秒时间戳
