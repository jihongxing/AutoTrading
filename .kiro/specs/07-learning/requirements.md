# Learning 自学习层 — 需求文档

## 模块定位
顾问角色，负责后验分析和参数优化建议，不直接干预交易。

## 宪法级原则
1. 自学习是顾问，不是执政者
2. 自学习不能直接影响实时交易
3. 自学习不能修改策略合约
4. 自学习不能触碰 L2 风控阈值
5. 所有调整有边界约束

## 功能需求

### FR-1: 数据收集
- FR-1.1: 收集策略信号数据
- FR-1.2: 收集执行结果数据
- FR-1.3: 收集盈亏数据
- FR-1.4: 收集市场行情数据

### FR-2: 后验分析
- FR-2.1: 成功/失败交易分析
- FR-2.2: 证人表现分析
- FR-2.3: 窗口判定准确率分析
- FR-2.4: 风控触发分析

### FR-3: 证人权重优化
- FR-3.1: 权重调整建议
- FR-3.2: 权重边界约束（0.1-0.9）
- FR-3.3: 单日最大调整幅度（5%）
- FR-3.4: 需要审批的调整

### FR-4: 仓位优化
- FR-4.1: 仓位放大系数优化
- FR-4.2: 默认仓位比例优化
- FR-4.3: 边界约束

### FR-5: 止盈止损优化
- FR-5.1: 止损微调（±0.5%）
- FR-5.2: 止盈微调（±0.5%）
- FR-5.3: 边界约束

### FR-6: 高交易窗口优化
- FR-6.1: 窗口判定阈值优化
- FR-6.2: 放大系数优化
- FR-6.3: 窗口评分方法优化

### FR-7: 学习报告
- FR-7.1: 成功率统计
- FR-7.2: 平均盈亏统计
- FR-7.3: 回撤统计
- FR-7.4: 优化效果评估

## 非功能需求

### NFR-1: 数据要求
- 需要足够样本量（> 100 笔）
- 短期波动不影响长期判断

### NFR-2: 可回滚
- 所有优化参数有完整日志
- 可恢复历史版本

### NFR-3: 独立性
- 与策略层解耦
- 与执行层解耦

## 约束条件
- 只能调整 L3 参数
- 不能触碰 L2 风控阈值
- 所有调整有硬边界约束
- 需要人工审核的调整必须等待审批
