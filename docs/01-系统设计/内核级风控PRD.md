# BTC 自动交易系统

## 内核级风控（Kernel Risk Control）PRD

---

## 1. 文档定位与目标

### 1.1 文档定位

本 PRD 定义 **BTC 自动交易系统的内核级风控模块（Kernel Risk Control, KRC）**，其职责是对系统整体运行安全性、可持续性和结构稳定性进行最高优先级的风险裁决。

该模块属于**系统内核规格**，而非策略、参数或执行层逻辑。

---

### 1.2 核心目标

- 防止系统进入**不可恢复风险状态**
    
- 阻断策略层、状态机在错误市场范式下持续运行
    
- 为交易引擎与学习模块提供**“被风控认可的数据环境”**
    

---

### 1.3 设计原则（基于弱信号组合哲学）

1. **风控优先于策略**：即使策略失效，只要风控有效，系统依然可以生存
    
2. **一票否决权**：风控决策不接受策略或状态机反驳
    
3. **系统级视角**：关注整体行为与结构风险，而非单笔盈亏
    
4. **状态可干预**：可直接修改或冻结全局状态
    
5. **最小智能假设**：不依赖预测，仅基于观测与统计偏离
    
6. **允许试错**：弱信号需要大样本验证，风控提供安全试错空间
    

---

## 2. 模块在系统中的位置

### 2.1 架构位置

```text
┌────────────────────────────┐
│   Kernel Risk Control (KRC) │
│   最高优先级 / 系统裁判层   │
└───────────┬────────────────┘
            │
Global State Machine
            │
Strategy Orchestrator
            │
Execution Engine
            │
Market

```


---

### 2.2 权限等级

|模块|是否可否决交易|是否可改写状态|
|---|---|---|
|内核级风控|✅|✅|
|全局状态机|❌|❌|
|策略编排|❌|❌|
|交易引擎|❌|❌|

---

## 3. 风控作用对象（Risk Domains）

内核级风控**只关心结构性风险**，覆盖以下 5 个风险域：

---

### 3.1 账户生存性风险（Account Survival Risk）

**监控目标**

- 总体权益（Equity）
    
- 回撤深度与回撤形态
    
- 权益波动率
    

**风控阈值（已冻结）**

| 参数 | 阈值 | 动作 |
|------|------|------|
| 最大回撤 | 20% | RISK_LOCKED |
| 单日最大亏损 | 3% | 当日停止交易 |
| 连续亏损次数 | 3次 | 进入 COOLDOWN |
| 周最大亏损 | 10% | 降低仓位 50% |

**典型触发条件**

- 超过最大允许回撤（20%）
    
- 单日亏损超过 3%
    
- 连续亏损 3 次
    
- 权益波动显著高于系统历史基准
    

**可执行动作**

- 冻结新交易
    
- 强制进入 `RISK_LOCKED`
    
- 可选：强制平仓（是否启用由系统配置）
    

---

### 3.2 执行完整性风险（Execution Integrity Risk）

**监控目标**

- 滑点分布
    
- 成交率
    
- 撮合延迟
    
- 拒单 / 异常单比例
    

**典型触发条件**

- 滑点显著偏离历史统计区间
    
- 连续执行失败
    
- 市场深度不足导致不可控成交
    

**可执行动作**

- 临时禁止下单
    
- 延长冷却期
    
- 切换至只观测模式
    

---

### 3.3 策略/范式失效风险（Regime Breakdown Risk）- 弱信号组合专用

**监控目标**

- Trade Regime 下的整体表现
    
- 证人组合胜率（目标：58-62%）
    
- 单个证人健康度（目标：52-55%）
    
- 连续失败结构
    

**典型触发条件（基于弱信号组合）**

- 证人组合胜率 < 50%（连续 50 笔交易）
    
- 单个核心证人胜率 < 48%（连续 30 笔交易）
    
- 多个证人在同一时间段集体失效
    
- 证人组合相关性突然升高（> 0.8，失去独立性）
    

**可执行动作**

- 降低失效证人权重
    
- 暂停失效证人（Mute）
    
- 否决当前 Regime
    
- 强制退出 ELIGIBLE 状态
    
- 触发假设工厂生成新假设
    

**核心原则**：
- 不追求单个证人 > 60% 成功率
- 关注证人组合后的整体表现
- 允许短期波动，关注长期趋势（> 100 笔交易）
    

---

### 3.4 系统行为失控风险（Behavioral Risk）

**监控目标**

- 单位时间交易频率
    
- 持仓数量
    
- 交易方向集中度
    

**典型触发条件**

- 高频交易行为异常
    
- 方向性过度集中
    
- 类似“报复性交易”的系统行为
    

**可执行动作**

- 限制最大交易频率
    
- 强制进入 `COOLDOWN`
    
- 暂停策略编排输出
    

---

### 3.5 系统稳定性与异常风险（System Stability Risk）

**监控目标**

- 模块通信延迟
    
- 数据完整性
    
- 状态同步异常
    

**典型触发条件**

- 状态不一致
    
- 数据延迟或缺失
    
- 核心模块不可用
    

**可执行动作**

- 停止交易
    
- 锁定系统
    
- 进入安全模式
    

---

## 4. 风控状态定义

### 4.1 内核风控状态（Risk State）

|状态|描述|
|---|---|
|NORMAL|风控未触发|
|WARNING|风险累积中，限制部分行为|
|COOLDOWN|冷却期，仅允许观测|
|RISK_LOCKED|系统级锁定，禁止交易|

---

### 4.2 状态优先级

```text
RISK_LOCKED
   ↑
COOLDOWN
   ↑
WARNING
   ↑
NORMAL

```


---

## 5. 与全局状态机的交互规则

### 5.1 风控对状态机的干预权

- 可直接中断 `ELIGIBLE`
    
- 可强制延长 `WAITING / COOLDOWN`
    
- 可冻结状态迁移
    

---

### 5.2 状态干预示例

```text
Global State: ELIGIBLE
↓
Kernel Risk Triggered
↓
Global State → RISK_LOCKED

```


---

## 6. 解锁与恢复机制（Recovery）

### 6.1 解锁方式

- 自动解锁（满足恢复条件）
    
- 手动解锁（人工确认）
    

---

### 6.2 恢复原则

- 恢复后 **不得立即满功率运行**
    
- 必须经过：
    
    - 降级策略
        
    - 限频
        
    - 缩小仓位
        

---

## 7. 与学习模块的边界约束

### 7.1 数据白名单原则

- 仅 `NORMAL / WARNING` 状态下的数据可用于学习
    
- `COOLDOWN / RISK_LOCKED` 数据默认不可训练
    

---

### 7.2 禁止行为

- 禁止学习模块反向影响风控阈值
    
- 禁止用风控失败期数据优化策略
    

---

## 8. 非目标（明确不做）

- ❌ 不预测市场
    
- ❌ 不优化收益
    
- ❌ 不进行策略选择
    
- ❌ 不参与下单细节
    

---

## 9. 核心设计总结（基于弱信号组合哲学）

> **内核级风控不是为了让系统赚钱，  
> 而是为了确保：系统永远有下一次赚钱的机会。**

> **在高效市场中，不存在"强信号"。  
> 风控的价值在于：让弱信号组合有足够的试错空间，  
> 同时确保试错不会导致系统死亡。**

**核心原则**：
- 风控优先于策略：即使策略失效，只要风控有效，系统依然可以生存
- 允许试错：弱信号需要大样本验证（> 100 笔），风控提供安全空间
- 长期视角：不因短期波动触发风控，关注长期统计偏离
- 系统目标：年化 20-50%，夏普 > 1.5，最大回撤 < 20%，生存 > 5 年