# 《BTC 自动交易系统 — 系统级架构冻结文档（Architecture Freeze）》

> **文档级别**：宪法级 / 不可随意修改  
> **目的**：冻结系统边界、职责划分与演进路径，防止“越写越像量化平台”

---

## 1. 架构冻结的目标与原则

### 1.1 核心目标

- 保证系统在 **极端行情、策略失效、交易所异常** 情况下依然可控
    
- 确保：
    
    - **风控优先于盈利**
        
    - **系统生存优先于收益**
        
    - **任何单一模块失效不导致系统崩溃**
        

---

### 1.2 冻结原则（不可违反）

1. **策略无下单权**
    
2. **风控拥有硬否决权**
    
3. **执行层必须幂等、可回滚**
    
4. **状态机是唯一交易入口**
    
5. **所有交易都可被审计与复盘**
    

> 上述 5 条属于 **系统不可变公理**

---

## 2. 冻结后的系统分层结构（最终版）

```text
┌──────────────────────────────┐
│        自学习 / 评估层        │  ← 只能“建议”，不能执行
└──────────────▲───────────────┘
               │
┌──────────────┴───────────────┐
│     决策 & 策略编排层          │  ← 多策略 / 多证人 / 权重
└──────────────▲───────────────┘
               │
┌──────────────┴───────────────┐
│      内核级风控层（并行）      │  ← 硬否决 / 冻结
└──────────────▲───────────────┘
               │
┌──────────────┴───────────────┐
│     全局状态机（宪法级）       │  ← 唯一合法通道
└──────────────▲───────────────┘
               │
┌──────────────┴───────────────┐
│         执行引擎层             │  ← 下单 / 撤单 / 成交
└──────────────▲───────────────┘
               │
┌──────────────┴───────────────┐
│         统一数据层             │  ← 唯一数据事实源
└──────────────────────────────┘

```


---

## 3. 模块职责冻结（防止职责污染）

### 3.1 策略层（Strategy）

**允许做的事**

- 识别结构
    
- 判断是否“值得参与”
    
- 生成候选信号（非交易指令）
    

**禁止做的事**

- 不得计算最终仓位
    
- 不得直接定义止损执行
    
- 不得感知账户余额
    

---

### 3.2 风控层（Risk）

**唯一职责**

- 判断 **“是否允许交易继续存在”**
    

风控可以：

- 否决入场
    
- 强制退出
    
- 冻结系统
    

风控 **不参与**：

- 策略优劣评判
    
- 盈利判断
    

---

### 3.3 全局状态机（State Machine）

**系统唯一事实裁判**

- 决定：
    
    - 是否进入可交易态
        
    - 是否进入锁定态（RISK_LOCKED）
        
- 严格状态迁移
    
- 不允许旁路
    

---

### 3.4 执行层（Execution）

**职责冻结**

- 接收合法交易指令
    
- 保证：
    
    - 幂等
        
    - 可撤回
        
    - 可确认
        
- 不判断行情，不判断策略
    

---

### 3.5 自学习层（Learning）

**定位冻结**

- 后验分析模块
    
- 只能影响：
    
    - 策略权重
        
    - 策略启停建议
        
- **不能直接影响实时交易**
    

---

## 4. 冻结的演进路径（允许的变化）

### ✅ 允许演进

- 增加策略数量
    
- 增加证人类型
    
- 调整权重模型
    
- 更换交易所
    

### ❌ 不允许演进

- 绕过状态机下单
    
- 策略直接控制仓位
    
- 风控“软化”为建议
    

---

## 5. 架构冻结结论

> **这是一个“交易操作系统内核”，而不是一个策略集合**

- 盈利能力来自策略
    
- 生存能力来自架构
    
- 长期收益来自约束