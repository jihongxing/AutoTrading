---
inclusion: always
priority: highest
---

# BTC 自动交易系统 — 核心规范（精简版）

> 详细规范见 `docs/` 目录，需要时使用 `#[[file:...]]` 引用

---

## 🔒 宪法级原则（不可违反）

1. **策略无下单权** — 策略只输出 Claim，不能直接下单
2. **风控硬否决权** — 风控决策不接受反驳
3. **状态机唯一入口** — 所有交易必须经过状态机
4. **TIER3 一票否决** — 否决证人可直接拒绝交易
5. **风控优先于策略** — 生存 > 盈利

---

## 📊 参数分层（L0-L3）

| 层级 | 类型 | 修改方式 | 存储 |
|------|------|----------|------|
| L0 | 宪法级 | 永不修改 | 硬编码 |
| L1 | 系统配置 | 人工+重启 | config/*.yaml |
| L2 | 风控阈值 | 需审批 | config/risk.yaml |
| L3 | 自学习参数 | 自动+边界 | 数据库 |

---

## 🛠️ 技术栈

- Python 3.11+ / FastAPI / asyncio / Pydantic v2
- QuestDB（时序数据）/ Kafka（消息队列）
- pytest / Poetry / Docker

---

## 📁 项目结构

```
src/
├── core/          # 状态机、风控、执行
├── strategy/      # 策略层（证人）
├── data/          # 数据层
├── learning/      # 自学习
├── api/           # REST API
└── common/        # 公共模块
```

---

## ⚡ 关键默认值

```yaml
# 仓位
default_position: 2%
max_single: 5%
max_total: 30%

# 风控
max_drawdown: 20%
daily_max_loss: 3%
consecutive_loss: 3次 → COOLDOWN

# 证人
min_witnesses: 2
core_aux_ratio: 2:1
```

---

## 📚 详细规范引用

需要详细信息时，引用以下文档：

- 架构约定：`#[[file:docs/规范/架构约定与开发规范.md]]`
- 技术栈：`#[[file:docs/规范/技术栈与编码规范.md]]`
- 交易参数：`#[[file:docs/规范/交易参数与风控规范.md]]`
- 数据规范：`#[[file:docs/规范/数据源与验证规范.md]]`

---

## ✅ 编码检查清单

- [ ] 策略只输出 Claim
- [ ] 风控保留硬否决权
- [ ] 交易经过状态机
- [ ] 参数从正确层级读取
- [ ] 使用 UTC 时间
- [ ] 结构化 JSON 日志

---

## 🗣️ 交互规范

- 中文交流
- 结论先行，简短直接
- 禁止未授权创建文档
- 不确定时先确认再执行
