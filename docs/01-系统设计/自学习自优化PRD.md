# BTC 自动交易系统 — 自学习自优化 PRD（文字版）

> **核心认知**：在高效市场中，不存在"强信号"。系统价值在于持续优化弱信号组合，通过大样本累积和动态调整实现长期稳定盈利。

## 1️⃣ 目的（基于弱信号组合哲学）

自学习自优化模块旨在利用系统历史交易数据和执行反馈，**持续优化弱信号证人组合**，并动态调整权重、仓位、止盈止损及风控参数，以实现：

- **长期稳定盈利**（年化 20-50%，夏普 > 1.5）
    
- **弱信号组合优化**（单个 52% → 组合 58-62%）
    
- **证人健康度管理**（降权/剔除失效证人，保持系统健康）
    
- **大样本累积优势**（通过大量交易显现统计优势）
    

---

## 2️⃣ 输入数据

|数据类型|描述|
|---|---|
|策略证人信号|每笔交易的多单/空单信号、仓位建议、止盈止损目标、证人权重|
|全局状态机|信号是否通过审批，状态转换历史|
|风控/宏观记录|冻结触发、否决、仓位限制、回撤限制|
|执行层订单结果|成交/未成交/撤单、执行时间、成交价格|
|仓位与资金|仓位变化、资金占用、账户余额|
|盈亏结果|每笔交易盈亏、累积盈亏|
|市场行情|价格、成交量、波动率、深度、微结构异常等|

---

## 3️⃣ 核心流程

```text
1. 数据收集与整理
   ├─ 收集策略信号、裁决结果、执行结果、市场行情
   └─ 标注每笔交易的成功/失败

2. 成功/失败分析
   ├─ 识别亏损交易的原因
   │   - 策略信号失效
   │   - 被风控冻结
   │   - 极端行情影响
   └─ 识别盈利交易的特征
       - 信号窗口、证人组合、仓位分配

3. 权重与参数优化
   ├─ 策略证人权重调整
   │   - 高成功率信号增加权重
   │   - 高失败率信号降低权重
   ├─ 仓位优化
   │   - 动态调整开仓比例
   │   - 对成功策略可加权增加仓位
   ├─ 止盈止损优化
   │   - 根据历史表现调整目标价格、阈值
   └─ 风控参数优化
       - 回撤阈值、冻结条件、极端波动判断

4. 模型迭代与策略更新
   ├─ 离线回测优化
   │   - 使用历史数据模拟策略调整效果
   └─ 在线迭代更新
       - 将优化参数应用到下一轮交易
       - 保持小幅度、渐进式调整，确保系统稳定

5. 评估与监控
   ├─ 成功率、平均盈亏、回撤统计
   ├─ 交易频率与信号通过率
   └─ 自动生成优化报告，支持人工审查

```


---

## 4️⃣ 自优化规则示例（基于弱信号组合）

1. **证人权重调整（接受弱信号）**
    
    - 成功率 > 55% → 增加权重 5~10%（优秀弱信号）
        
    - 成功率 52-55% → 保持权重（正常弱信号）
        
    - 成功率 < 50% → 减少权重 5~10%（失效信号）
        
    - 成功率 < 48% → 暂时冻结或剔除（反向信号）
    
    **注意**：不追求 > 60% 成功率，52-55% 即为有效弱信号
        
2. **仓位调整**
    
    - 高置信号窗口 + 盈利历史 → 可增加仓位比例
        
    - 多次亏损窗口 → 降低仓位或暂时冻结
        
3. **止盈止损动态调整**
    
    - 低波动环境 → 收紧止损，延长止盈
        
    - 高波动环境 → 扩大止损空间，缩短止盈目标
        
4. **风控参数优化**
    
    - 最大回撤阈值根据历史表现动态调整
        
    - 极端波动触发冻结逻辑优化，避免频繁冻结或错失机会
        

---

## 5️⃣ 设计原则（基于弱信号组合哲学）

1. **接受弱信号，优化组合**
    
    - 不追求单个证人 > 60% 成功率
        
    - 关注证人组合后的整体表现（58-62%）
        
    - 通过大样本累积验证弱信号有效性
        
2. **离线优先、在线渐进**
    
    - 初期离线分析和回测为主
        
    - 在线迭代只做小幅度调整，避免一次性破坏系统稳定性
        
3. **完全可回滚**
    
    - 所有优化参数、证人权重、仓位调整有完整日志
        
    - 可恢复历史版本，保证系统安全
        
4. **独立模块**
    
    - 与策略证人、状态机、执行层解耦
        
    - 只提供优化参数和建议信号，不直接干预交易决策
        
5. **数据驱动 + 大样本**
    
    - 优化完全基于历史交易和市场行情
        
    - 需要足够样本量（> 100 笔）才能判断证人有效性
        
    - 短期波动不影响长期判断
        

---

## 6️⃣ 输出

|输出内容|描述|
|---|---|
|优化证人权重|提供下一轮交易使用的证人权重|
|仓位优化建议|动态开仓比例、加减仓策略|
|动态止盈止损参数|调整目标止盈/止损价格和阈值|
|风控参数调整|回撤阈值、冻结逻辑优化|
|学习报告|成功/失败统计、优化效果、回测结果|

---

## 7️⃣ 系统流程总结（文字版）

```text
历史交易数据 + 市场行情
        │
        ▼
    数据收集与标注
        │
        ▼
  成功/失败分析 → 提取特征
        │
        ▼
  权重与参数优化
        │
        ▼
  离线回测 → 在线渐进迭代
        │
        ▼
  执行层 / 策略层参数更新
        │
        ▼
  下一轮交易

```



## 8、BTC 自动交易系统 — 证人 + 自学习闭环文字版流程


```text
┌─────────────────────────────┐
│ 1. 策略证人信号产生          │
│ （核心盈利证人 + 辅助增强证人）│
│ 多单/空单方向、仓位建议、止盈止损目标 │
└───────────────┬─────────────┘
                │
                ▼
┌─────────────────────────────┐
│ 2. 全局状态机与裁决层整合信号 │
│ - 多策略证人投票/权重合并     │
│ - 核心证人高权重优先         │
└───────────────┬─────────────┘
                │
                ▼
┌─────────────────────────────┐
│ 3. 风控/宏观证人审批         │
│ - 仓位限制、最大回撤、极端波动│
│ - 宏观新闻、政策、稳定币流动性│
│ - 可以冻结或否决交易信号      │
└───────┬─────────────────────┘
        │
  ┌─────┴─────┐
  │           │
  ▼           ▼
信号通过      信号冻结或否决
  │           │
  │           └─► 执行层撤单/冻结 → 仓位回滚 → 日志记录
  │
  ▼
┌─────────────────────────────┐
│ 4. 执行层下单/平仓/仓位管理  │
│ - 多单/空单开平仓            │
│ - 动态仓位调整、止盈止损      │
│ - 严格执行批准信号           │
└───────────────┬─────────────┘
                │
                ▼
┌─────────────────────────────┐
│ 5. 自学习模块收集反馈         │
│ - 每笔交易盈亏、信号表现       │
│ - 执行成功/失败、风控触发情况 │
│ - 市场行情和极端事件          │
└───────────────┬─────────────┘
                │
                ▼
┌─────────────────────────────┐
│ 6. 自学习分析与优化           │
│ - 评估单个证人成功率与组合表现 │
│ - 调整证人权重                │
│ - 增删或冻结表现不佳的证人      │
│ - 优化仓位、止盈止损、风控参数 │
└───────────────┬─────────────┘
                │
                ▼
┌─────────────────────────────┐
│ 7. 更新证人体系 & 参数         │
│ - 下一轮策略信号使用优化后的证人│
│ - 更新执行层仓位/止盈止损/风控 │
└─────────────────────────────┘
                │
                └────────────► 回到 1，形成闭环

```


## 9、高交易窗口判定文字版流程示意

```text
┌─────────────────────────────┐
│ 1. 策略层 / 策略编排 PRD    │
│ 高交易窗口判定逻辑所在位置   │
│ 输入：                        │
│ - 核心证人信号（波动率释放+区间破坏） │
│ - 辅助证人信号（时间结构优势、微结构异常等） │
│ - 当前市场行情（价格、成交量、波动率、深度） │
│ 输出：                        │
│ - 是否属于高交易窗口           │
│ - 建议仓位放大系数             │
└───────────────┬─────────────┘
                │
                ▼
┌─────────────────────────────┐
│ 2. 执行层 / 执行层 PRD        │
│ 输入：                        │
│ - 高交易窗口判定结果           │
│ - 建议仓位放大系数             │
│ 输出：                        │
│ - 实际下单仓位调整             │
│ - 动态止盈止损放大/缩减        │
└───────────────┬─────────────┘
                │
                ▼
┌─────────────────────────────┐
│ 3. 自学习 / 自学习自优化 PRD  │
│ 输入：                        │
│ - 历史交易数据（信号、执行结果、盈亏） │
│ - 高交易窗口判定记录           │
│ 输出：                        │
│ - 优化高交易窗口判定阈值        │
│ - 调整信号权重与窗口评分方法    │
│ - 建议调整放大系数或冻结窗口    │
└───────────────┘

说明：
1. 高交易窗口判定逻辑属于策略层，但其输出影响执行层的仓位和止盈止损策略。
2. 自学习模块周期性优化高交易窗口判定规则和阈值。
3. 执行层只使用窗口输出，不参与判定逻辑本身。
4. 形成完整闭环：
   策略层判定 → 执行层应用 → 自学习反馈 → 策略层优化

```
